<html>
<head>
<title>SIMION Geometry Optimization Example</title>

<style type="text/css">
  body { font-family: verdana, arial, sans-serif; font-size: 90%; }
  .copyright {font-size:80%; border-top:1px solid black}
  .title1 {background-color:#80ff80}
  .links1 {background-color:#c0ffc0}
  .content {max-width:30em; margin-left:5px; margin-right:5px }
  h1 {margin-top: 0; margin-bottom: 0; background-color:#e0ffe0; font-size:130%}
  h2 {font-size:120%}
  h3 {font-size:110%}
  h4, h5, h6 {font-size:100%}

  /* doxygen */
  body {margin-left:0px; margin-right:0px}
  TD.mdname { width:auto }

  /* epydoc */
  .py-prompt { display:none }
</style>
</head>

<body  marginwidth="0" marginheight="0" leftmargin="0" topmargin="0" rightmargin="0" bottommargin="0">
<div class="title1">
<a href="../../README.html">SIMION&#153; 8.0</a>
</div>
<!--<div class="links1"><a href="../../README.html">Main Page</a></div>-->
<h1>SIMION Geometry Optimization Example</h1>
<div class="content">



<h2>Purpose</h2>

<p>
This is a simple example of doing <b>geometry optimization</b> through
SIMION 8's <b>batch mode operation</b>.  In geometry optimization, we
parameterize certain features of the geometry, vary those parameters
over some domain, and run the simulation for each variation.  Each
variation requires building a GEM file, convering it to a PA, refining
the PA, and flying ions.  This is entirely automated through SIMION
8's batch mode of operation, thereby allowing the examination of a
large number of geometries at one time.  Geometry optimization is
analogous to <b>voltage optimization</b> such as done in SIMION's
"tune" example, where the voltages are varied over some domain and the
simulation is run for each variation.  Voltage optimization is much
easier than geometry optimization though since voltages can be rapidly
changed via <b>fast adjusting</b>, but geometry changes generally
require rebuilding the potential array.
</p>

<h2>Description</h2>

<p>
In this example, a simple three element fast adjust lens is provided.
We seek to find the optimium axial position of the middle electrode
such that the particles splat closest to the axis (y offset of zero).
The axial x-offset of the middle electrode is varied over the domain
[-40, 40] gu, and the y-offset of the outermost particle splat is
recorded for each geometry.
</p>

<p>This should serve as a simple example of how geometry optimization
problems might be approached.  A more complex but more efficient
version might implement a binary search (like in the "tune" example) or
a simplex optimization scheme.
</p>

<p><img src="resources/lens.png" alt="Picture of tune.pa#">
<br><b>Figure:</b> Geometry tune.pa# using parameterization of
x-offset = 0 gu.
</p>

<h2>Files in this demo:</h2>

<ul>
<li><b>README.html</b> - Description of the demo.</li>
<li><b>geometry_optimize.lua</b> - Batch mode Lua program.  This is the program you run.</li>
<li><b>tune.iob</b> - SIMION workbench. contains tune.fly, tune.pa0, and tune.lua.
<li><b>tune.lua</b> - SIMION user program.  This simple program
  mainly just outputs the desired y-offset result via data recording.
<li><b>tune.fly</b> - SIMION particle definitions.
<li><b style="color:#808080">tune.pa?</b> - SIMION potential array files.  These are generated
   from tune.gem.
<li><b style="color:#808080">tune.gem</b> - SIMION geometry (GEM) file.  This is generated
   by geometry_optimize.lua for each parameterization.
<li><b style="color:#808080">tmp.csv</b> - Temporary SIMION data recording results from the
  current parameterization.
<li><b style="color:#808080">results.csv</b> - Summary results generated by geometry_optimize.lua.
  This is the results you analyze.
</ul>

<h2>Usage</h2>

<p>The program can be run as follows.</p>

<ul>
<li>1. <b>Run the "geometry_optimize.lua" Lua program.</b>
    <i>(In SIMION, click "Run Lua Program" and select
    "geometry_optimize.lua".)</i> Lots of output will display on the
    screen, but the summary results will be
    <b>saved to the file results.csv</b>, which can be viewed in a
    program such as Excel or a text editor.
    (Alternately, the program may be run from the command-line as follows:
    "simion.exe --nogui lua geometry_optimize.lua".)
</ul>

<h2>Results</h2>

<p>The below graph was generated by plotting the data in results.csv
in Excel.  Note that there are actually two optimium geometries
(&Delta;x = 0 and &Delta;x = -12.6 gu).</p>

<p>
<img src="resources/graph.png" alt="SIMION Geometry Optimization Results (from results.csv"><br>
<b>Figure:</b> SIMION Geometry optimization results (from results.csv).
</p>

<h2>Additional Comments</h2>

<p>The batch mode program could be implemented quite
similarly in any other language via the SIMION Command Line API.  This
Lua program uses the built-in "simion.command" function which executes
a SIMION function directly (in-process) via an interface identical to
the SIMION Command Line API.  See the Command Line Inteferface appendix
of the printed SIMION manual for details.
</p>

<h2>Source</h2>

<p>
Author: D.Manura, 2006-08.  Geometry based on the "tune" example.
</p>

</div>
    
<div class="copyright">SIMION&#153; 8.0 (c) 2003-2007 Scientific
Instrument Services, Inc. All Rights Reserved.
</div>
    </body>
</html>
